<ng-container *ngIf="($props | async) as props">
    <div class="w-full h-full px-window pt-window" cdkVirtualScrollingElement>
        <scngx-ui-title>Warteschlange</scngx-ui-title>

        <scngx-empty-page-banner *ngIf="props.tracks?.length <= 0 && !props.enqueuedTracklist" message="Hier werden alle eingereihten Songs angezeigt, sobald du beginnst Alben oder Playlists zu streamen"></scngx-empty-page-banner>
    
        <!-- Current songs -->
        <div class="flex flex-col gap-3" *ngIf="props.current">
            <h6>Aktueller Song</h6>
            <scngx-song-list-item 
                [song]="props.current" 
                [index]="0"
                [active]="true" 
                [playing]="props.isPlaying"
                [animRef]="lottieAnimationTemplate"
                (onPlay)="togglePlaying()">
            </scngx-song-list-item>
        </div>
    
        <!-- Enqueued songs -->
        <div class="mt-row" *ngIf="props.tracks?.length > 0">
            <h6>Nächster Song</h6>

            <cdk-virtual-scroll-viewport [itemSize]="56">
                <div *cdkVirtualFor="let item of props.tracks; index as i" class="px-window">
                    <!-- <scngx-song-list-item 
                        [song]="item" 
                        [index]="i" 
                        [active]="props.currentItemId === item?.id && props.isTracklistActive"
                        [animRef]="lottieAnimationTemplate"
                        (onPlay)="forcePlayAt(props.artist.data, i, item.id)">
                    </scngx-song-list-item> -->
                    <scngx-song-list-item 
                        [song]="item" 
                        [index]="props.current ? i+1 : i" 
                        [playing]="props.isPlaying"
                        [animRef]="lottieAnimationTemplate">
                    </scngx-song-list-item>
                </div>
            </cdk-virtual-scroll-viewport>
        </div>

        <!-- Enqueued tracklist -->
        <div class="mt-row" *ngIf="props.enqueuedTracklist">
            <h6>Nächster Song aus: {{ props.enqueuedTracklist?.name }}</h6>

            <cdk-virtual-scroll-viewport [itemSize]="56">
                <div *cdkVirtualFor="let item of props.tracklistQueue; index as i">
                    <!-- <scngx-song-list-item 
                        [active]="props.currentItemId === item?.id && props.isTracklistActive"
                        (onPlay)="forcePlayAt(props.artist.data, i, item.id)">
                    </scngx-song-list-item> -->
                    <scngx-song-list-item 
                        [song]="item" 
                        [index]="props.current ? (props.tracks?.length)+i+1 : (props.tracks?.length)+i" 
                        [playing]="props.isPlaying"
                        [animRef]="lottieAnimationTemplate">
                    </scngx-song-list-item>
                </div>
            </cdk-virtual-scroll-viewport>
        </div>    
        <div class="pb-bottom"></div>
    </div>
</ng-container>

<ng-template #lottieAnimationTemplate>
    <ng-lottie [options]="animOptions" class="aspect-square"></ng-lottie>
</ng-template>